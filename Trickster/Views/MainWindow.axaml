<!-- Views/MainWindow.axaml -->
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:Trickster.ViewModels"
        x:Class="Trickster.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        x:Name="MainWindowRoot"
        Width="1200" Height="700"
        Title="Actor Editor">

    <!-- Add Styles Here -->
    <Window.Styles>
        <StyleInclude Source="/Styles/EditorStyles.axaml"/>
    </Window.Styles>

    <DockPanel>
        <!-- Menu Bar -->
        <DockPanel DockPanel.Dock="Top" Classes="MenuBar">
            <Menu DockPanel.Dock="Left">
                <MenuItem Header="_File">
                    <MenuItem Header="_Open..." 
                              Command="{Binding OpenFileCommand}"
                              CommandParameter="{Binding $parent[Window]}"
                              InputGesture="Ctrl+O" />
                    <MenuItem Header="_Save" 
                              Command="{Binding SaveFileCommand}"
                              CommandParameter="{Binding $parent[Window]}"
                              InputGesture="Ctrl+S" />
                    <MenuItem Header="Save _As..." 
                              Command="{Binding SaveFileAsCommand}"
                              CommandParameter="{Binding $parent[Window]}"
                              InputGesture="Ctrl+Shift+S" />
                </MenuItem>
            </Menu>
        </DockPanel>

        <!-- Status Bar -->
        <Border DockPanel.Dock="Bottom" 
                Background="{StaticResource ParchmentMedium}"
                Padding="10,5"
                BorderBrush="{StaticResource BorderMedium}"
                BorderThickness="0,1,0,0">
            <TextBlock Text="{Binding StatusMessage}" 
                       FontSize="11"
                       Foreground="{StaticResource TextDark}" />
        </Border>

        <!-- Main Content -->
        <Border Classes="ContentPanel">
            <Grid ColumnDefinitions="250,*" Margin="10">

                <!-- Left Panel: Actor List -->
                <Border Grid.Column="0" 
                        Classes="SidebarPanel"
                        CornerRadius="8"
                        Margin="0,0,10,0">
                    <Grid RowDefinitions="Auto,*,Auto">
                        <TextBlock Grid.Row="0" 
                                   Text="ðŸŽ­ Actors" 
                                   Classes="SectionHeader"
                                   Margin="0,0,0,10" />

                        <ListBox Grid.Row="1"
                                 ItemsSource="{Binding Actors}"
                                 SelectedItem="{Binding SelectedActor}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Spacing="3" Margin="5">
                                        <TextBlock Text="{Binding Id}" 
                                                   FontWeight="Bold" 
                                                   FontSize="12" />
                                        <TextBlock Text="{Binding DisplayName}" 
                                                   Classes="SmallText" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <StackPanel Grid.Row="2" Spacing="5" Margin="0,10,0,0">
                            <Button Content="+ Add Actor" 
                                    Command="{Binding AddActorCommand}"
                                    Classes="PrimaryButton"
                                    HorizontalAlignment="Stretch" />
                            <Button Content="ðŸ—‘ï¸ Delete Actor" 
                                    Command="{Binding DeleteActorCommand}"
                                    Classes="SecondaryButton"
                                    HorizontalAlignment="Stretch" />
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Right Panel: Actor Details -->
                <ScrollViewer Grid.Column="1">
                    <StackPanel Spacing="15" 
                                IsEnabled="{Binding SelectedActor, Converter={x:Static ObjectConverters.IsNotNull}}">

                        <!-- Basic Info -->
                        <Border Background="{StaticResource ParchmentMedium}"
                                Padding="15" 
                                CornerRadius="8">
                            <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="100,*">
                                <TextBlock Grid.Row="0" Grid.ColumnSpan="2"
                                           Text="Basic Info" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           Foreground="{StaticResource TextDark}"
                                           Margin="0,0,0,10" />

                                <TextBlock Grid.Row="1" Grid.Column="0"
                                           Text="ID:" 
                                           VerticalAlignment="Center"
                                           Foreground="{StaticResource TextMedium}"
                                           Margin="0,5" />
                                <TextBox Grid.Row="1" Grid.Column="1"
                                         Text="{Binding SelectedActor.Id}"
                                         Watermark="e.g., tomo"
                                         Margin="0,5" />

                                <TextBlock Grid.Row="2" Grid.Column="0"
                                           Text="Display Name:" 
                                           VerticalAlignment="Center"
                                           Foreground="{StaticResource TextMedium}"
                                           Margin="0,5" />
                                <TextBox Grid.Row="2" Grid.Column="1"
                                         Text="{Binding SelectedActor.DisplayName}"
                                         Watermark="e.g., Tomo"
                                         Margin="0,5" />
                            </Grid>
                        </Border>

                        <!-- Textures -->
                        <Border Background="{StaticResource ParchmentMedium}"
                                Padding="15" 
                                CornerRadius="8">
                            <StackPanel Spacing="10">
                                <Grid ColumnDefinitions="*,Auto">
                                    <TextBlock Grid.Column="0"
                                               Text="Textures" 
                                               FontWeight="Bold" 
                                               FontSize="14"
                                               Foreground="{StaticResource TextDark}" />
                                    <Button Grid.Column="1"
                                            Content="+ Add Texture"
                                            Command="{Binding AddTextureCommand}"
                                            Classes="PrimaryButton"
                                            Padding="10,5" />
                                </Grid>

                                <Grid ColumnDefinitions="120,*,Auto">
                                    <TextBlock Grid.Column="0"
                                               Text="Texture Set:" 
                                               Classes="SmallText"
                                               VerticalAlignment="Center" />
                                    <ComboBox Grid.Column="1"
                                              ItemsSource="{Binding SelectedActor.TextureKeys}"
                                              SelectedItem="{Binding SelectedTextureName}"
                                              HorizontalAlignment="Stretch"
                                              Margin="5,0" />
                                    <Button Grid.Column="2"
                                            Content="ðŸ—‘ï¸"
                                            Command="{Binding DeleteTextureCommand}"
                                            Classes="SecondaryButton"
                                            Padding="8,5" />
                                </Grid>

                                <!-- Texture Details -->
                                <Border Background="{StaticResource ParchmentLight}"
                                        Padding="10" 
                                        CornerRadius="4"
                                        IsVisible="{Binding SelectedTexture, Converter={x:Static ObjectConverters.IsNotNull}}">
                                    <StackPanel Spacing="8">
                                        <!-- Project Root Setting (Optional) -->
                                        <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,5">
                                            <TextBlock Grid.Column="0"
                                                       Classes="SmallText"
                                                       VerticalAlignment="Center">
                                                <Run Text="Project Root: " />
                                                <Run Text="{Binding ProjectRootPath}" 
                                                     FontStyle="Italic"
                                                     Foreground="{StaticResource AccentPrimary}" />
                                            </TextBlock>
                                            <Button Grid.Column="1"
                                                    Content="Set Root Folder"
                                                    Command="{Binding SetProjectRootCommand}"
                                                    CommandParameter="{Binding $parent[Window]}"
                                                    Classes="SecondaryButton"
                                                    Padding="8,4"
                                                    FontSize="10" />
                                        </Grid>
                                        
                                        <Separator />
                                        
                                        <!-- Atlas Path with Browse Button -->
                                        <TextBlock Text="Atlas Path:" 
                                                   Classes="SmallText" />
                                        <Grid ColumnDefinitions="*,Auto">
                                            <TextBox Grid.Column="0"
                                                     Text="{Binding SelectedTexture.AtlasPath}"
                                                     Watermark="e.g., res://assets/textures/tomo_shizu_minigame.png"
                                                     Margin="0,0,5,0" />
                                            <Button Grid.Column="1"
                                                    Content="ðŸ“ Browse"
                                                    Command="{Binding BrowseAtlasPathCommand}"
                                                    CommandParameter="{Binding $parent[Window]}"
                                                    Classes="SecondaryButton"
                                                    Padding="8,4" />
                                        </Grid>

                                        <!-- Atlas Regions Header with Add Button -->
                                        <Grid ColumnDefinitions="*,Auto" Margin="0,10,0,0">
                                            <TextBlock Grid.Column="0"
                                                       Text="Atlas Regions:" 
                                                       Classes="SmallText"
                                                       VerticalAlignment="Center" />
                                            <Button Grid.Column="1"
                                                    Content="+ Add Region"
                                                    Command="{Binding AddAtlasRegionCommand}"
                                                    Classes="PrimaryButton"
                                                    Padding="8,4"
                                                    FontSize="11" />
                                        </Grid>
                                        
                                        <Border Background="White"
                                                BorderBrush="{StaticResource BorderMedium}"
                                                BorderThickness="1"
                                                CornerRadius="4"
                                                Padding="10"
                                                MaxHeight="300">
                                            <ScrollViewer>
                                                <ItemsControl ItemsSource="{Binding SelectedTexture.AtlasRegions}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Background="{StaticResource ParchmentLight}"
                                                                    Padding="10"
                                                                    Margin="0,0,0,8"
                                                                    CornerRadius="3">
                                                                <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto">
                                                                    <!-- Region Name (Editable) and Delete Button -->
                                                                    <TextBox Grid.Row="0" Grid.Column="0"
                                                                             Text="{Binding Key}"
                                                                             FontWeight="SemiBold"
                                                                             FontSize="12"
                                                                             Watermark="Region name"
                                                                             Margin="0,0,8,8" />
                                                                    <Button Grid.Row="0" Grid.Column="1"
                                                                            Content="ðŸ—‘ï¸"
                                                                            Command="{Binding #MainWindowRoot.DataContext.DeleteAtlasRegionCommand}"
                                                                            CommandParameter="{Binding Key}"
                                                                            Classes="SecondaryButton"
                                                                            Padding="6,2"
                                                                            FontSize="11"
                                                                            Margin="0,0,0,8" />
                                                                    
                                                                    <!-- Editable Fields -->
                                                                    <!-- Editable Fields -->
                                                                    <Grid Grid.Row="1" Grid.ColumnSpan="2" ColumnDefinitions="100,80,80,80,80">
                                                                        <StackPanel Grid.Column="0" Spacing="3">
                                                                            <TextBlock Text="X:" 
                                                                                    Classes="SmallText" />
                                                                            <TextBox Text="{Binding X}"
                                                                                    Watermark="0"
                                                                                    Height="28" />
                                                                        </StackPanel>
    
                                                                        <StackPanel Grid.Column="1" Spacing="3" Margin="5,0,0,0">
                                                                            <TextBlock Text="Y:" 
                                                                                    Classes="SmallText" />
                                                                            <TextBox Text="{Binding Y}"
                                                                                    Watermark="0"
                                                                                    Height="28" />
                                                                        </StackPanel>
    
                                                                        <StackPanel Grid.Column="2" Spacing="3" Margin="5,0,0,0">
                                                                            <TextBlock Text="Width:" 
                                                                                    Classes="SmallText" />
                                                                            <TextBox Text="{Binding Width}"
                                                                                    Watermark="128"
                                                                                    Height="28" />
                                                                        </StackPanel>
    
                                                                        <StackPanel Grid.Column="3" Spacing="3" Margin="5,0,0,0">
                                                                            <TextBlock Text="Height:" 
                                                                                    Classes="SmallText" />
                                                                            <TextBox Text="{Binding Height}"
                                                                                    Watermark="128"
                                                                                    Height="28" />
                                                                        </StackPanel>
                                                                    </Grid>
                                                                </Grid>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </ScrollViewer>
                                        </Border>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </ScrollViewer>

            </Grid>
        </Border>
    </DockPanel>
</Window>